pair2plot<-'SPP1_S1PR1'
n_cell<-length(cell_types)
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
pair2plot<-'IGF1_IGF1R'
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
source("~/bin/R_scripts/plot_lr_wiring.R")
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
pair2plot<-'SEMA3D_NRP1'
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
pair2plot<-'TNFSF9_TRAF2'
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
young_net[young_net$Pair.Name==pair2plot,17:ncol(old_net)]
old_net[old_net$Pair.Name==pair2plot,17:ncol(old_net)]
pair2plot<-'ANGPT2_TEK'
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
pair2plot<-'CCL5_CCR1'
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
young_net[young_net$Pair.Name==pair2plot,17:ncol(old_net)]
old_net[old_net$Pair.Name==pair2plot,17:ncol(old_net)]
###Explore expression complementarity###
zonation<-read.xlsx("~/Dropbox/research_projects/single cell metabolic network/liver spatial single cell RNA-seq/nature21065-s4.xlsx",sheet=1,startRow = 3,na.strings = "NaN")
zonation<-na.omit(zonation)
expression_level_normal<-data.frame(genes=toupper(zonation$Gene.Symbol),zonation[,2:10])
max_min<-apply(expression_level_normal[,2:10],1,max) - apply(expression_level_normal[,2:10],1,min)
min_val<-apply(expression_level_normal[,2:10],1,min)
expression_level_normal[,2:10]<-(expression_level_normal[,2:10] - matrix(rep(min_val,9),nrow=nrow(expression_level_normal),ncol=9,byrow = F))/(matrix(rep(max_min,9),nrow=nrow(expression_level_normal),ncol=9,byrow=F))
expression_level_normal$genes<-toupper(expression_level_normal$genes)
load("~/Dropbox/research_projects/Kelly_Stevens/receptor_ligand_database_PMID26198319.RData")
receptor_ligand<-receptor_ligand[-grep("EXCLUDED",receptor_ligand$Pair.Evidence),]
ind1<-match(receptor_ligand$Ligand.ApprovedSymbol,expression_level_normal$genes)
summary(expression_level_normal[,2])
summary(expression_level_normal[,3])
summary(expression_level_normal[,4])
###Explore expression complementarity###
zonation<-read.xlsx("~/Dropbox/research_projects/single cell metabolic network/liver spatial single cell RNA-seq/nature21065-s4.xlsx",sheet=1,startRow = 3,na.strings = "NaN")
zonation<-na.omit(zonation)
expression_level_normal<-data.frame(genes=toupper(zonation$Gene.Symbol),zonation[,2:10])
summary(expression_level_normal[,2])
summary(expression_level_normal[,3])
summary(expression_level_normal[,4])
good<- rowSums(expression_level_normal[,2:10]>3e-7)>=1
table(good)
###Explore expression complementarity###
zonation<-read.xlsx("~/Dropbox/research_projects/single cell metabolic network/liver spatial single cell RNA-seq/nature21065-s4.xlsx",sheet=1,startRow = 3,na.strings = "NaN")
zonation<-na.omit(zonation)
expression_level_normal<-data.frame(genes=toupper(zonation$Gene.Symbol),zonation[,2:10])
good<- rowSums(expression_level_normal[,2:10]>3e-7)>=1
expression_level_normal<-expression_level_normal[good,]
max_min<-apply(expression_level_normal[,2:10],1,max) - apply(expression_level_normal[,2:10],1,min)
min_val<-apply(expression_level_normal[,2:10],1,min)
expression_level_normal[,2:10]<-(expression_level_normal[,2:10] - matrix(rep(min_val,9),nrow=nrow(expression_level_normal),ncol=9,byrow = F))/(matrix(rep(max_min,9),nrow=nrow(expression_level_normal),ncol=9,byrow=F))
expression_level_normal$genes<-toupper(expression_level_normal$genes)
load("~/Dropbox/research_projects/Kelly_Stevens/receptor_ligand_database_PMID26198319.RData")
receptor_ligand<-receptor_ligand[-grep("EXCLUDED",receptor_ligand$Pair.Evidence),]
ind1<-match(receptor_ligand$Ligand.ApprovedSymbol,expression_level_normal$genes)
ind2<-match(receptor_ligand$Receptor.ApprovedSymbol,expression_level_normal$genes)
ligand_mat<-expression_level_normal[ind1,2:10]
receptor_mat<-expression_level_normal[ind2,2:10]
bad<- is.na(ligand_mat[,1]) | is.na(receptor_mat[,1])
ligand_mat<-ligand_mat[!bad,]
receptor_mat<-receptor_mat[!bad,]
cell2cell<- t(as.matrix(ligand_mat)) %*% as.matrix(receptor_mat)
pheatmap(cell2cell,cluster_cols = F,cluster_rows = F)
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
go_product<-read.table(paste(tissues[i],"_net_sc_product_KL_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
go_deg<-read.table(paste(tissues[i],"_net_sc_DEG_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
#go_product<-go_product[go_product$FDR<0.05,]
#go_deg<-go_deg[go_deg$FDR<0.05,]
fdr_thresh<-0.05
diff_thresh<-2
interesting<-union(go_deg$Term[1:50],go_product$Term[1:50])
all_gos<-rbind(go_deg,go_product)
all_gos<-all_gos[!duplicated(all_gos$GO.ID),]
ind<-match(interesting,all_gos$Term)
toplot<-data.frame(id=all_gos$GO.ID[ind],name=interesting,fdr_product=1,fdr_deg=1)
ind<-match(toplot$name,go_product$Term)
toplot$fdr_product[!is.na(ind)]<-go_product$FDR[ind[!is.na(ind)]]
ind<-match(toplot$name,go_deg$Term)
toplot$fdr_deg[!is.na(ind)]<-go_deg$FDR[ind[!is.na(ind)]]
toplot<-arrange(toplot,fdr_product)
toplot<-toplot[toplot$fdr_product<fdr_thresh | toplot$fdr_deg<fdr_thresh,]
toplot$color<-ifelse(toplot$fdr_product < toplot$fdr_deg,'darkolivegreen3','darkorange')
method_comparison$better[i]<-sum(toplot$fdr_product<toplot$fdr_deg)
method_comparison$total[i]<-nrow(toplot)
result<-binom.test(method_comparison$better[i],method_comparison$total[i],alternative = 'greater')
method_comparison$pvals[i]<-result$p.value
}
method_comparison$FDR<-p.adjust(method_comparison$pvals,method="BH")
write.xlsx(method_comparison,file="table S7.xlsx")
method_comparison$worse<-method_comparison$total - method_comparison$better
temp<-method_comparison[,c('tissues','better','worse')]
temp<-arrange(temp,desc(better))
temp$tissues<-factor(temp$tissues,levels=rev(temp$tissues),ordered=T)
colnames(temp)<-c("tissues","talklr","DEG")
temp<-melt(temp,id.vars = 'tissues')
temp$variable<-factor(temp$variable,levels=c("DEG","talklr"),ordered=T)
good_color<-'black'
bad_color<-'grey'
#temp$label_color<-ifelse(temp$tissues %in% method_comparison$tissues[method_comparison$FDR<0.05],"red",'grey')
pdf("Tabula_Muris_19_tissue_Method_comarision_v10.pdf",width=5,height=5)
ggplot(temp,aes(x=tissues,y=value,fill=variable)) + geom_bar(width=0.8,stat='identity',color='grey',position = position_dodge(width=0.8)) + xlab("Tissues") + ylab("Number of significant GO terms")  +  labs(fill="Method")+ theme_bw() + theme(legend.position = 'top',axis.text.y = element_text(size=14,color=rev(rep(c(rep(good_color,14),bad_color,good_color,bad_color,good_color,bad_color)))),axis.text.x = element_text(size=14),axis.title = element_text(size=15),legend.text = element_text(size=13)) + coord_flip() +
#scale_fill_manual(values=c("lightskyblue1","mistyrose1"))
#scale_fill_manual(values=c("cadetblue4","indianred3"))
#scale_fill_manual(values=c('cadetblue4','mediumpurple3'))
#scale_fill_manual(values=c("cadetblue4","mediumorchid"))
#scale_fill_manual(values=c("royalblue3","mediumorchid"))
#scale_fill_manual(values=c("darkolivegreen3","darkorange"))
scale_fill_manual(values=c("darkorange","darkolivegreen3"))
dev.off()
#plot#
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
go_product<-read.table(paste(tissues[i],"_net_sc_product_KL_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
go_deg<-read.table(paste(tissues[i],"_net_sc_DEG_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
#go_product<-go_product[go_product$FDR<0.05,]
#go_deg<-go_deg[go_deg$FDR<0.05,]
fdr_thresh<-0.05
diff_thresh<-2
interesting<-union(go_deg$Term[1:50],go_product$Term[1:50])
p3<-plot_GO_comparison_return_plot(go_deg,go_product,interesting,fdr_thresh,diff_thresh,paste(tissues[i],'_net_DEG_vs_KL_',nrow(tissue_deg_pairs),'_pairs.pdf',sep=""))
pdf(paste(tissues[i],"_pairs_KL_pseudo_count.pdf",sep=""))
print(p3)
dev.off()
}
#plot#
setwd("./Tabula_Muris_V2/")
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
go_product<-read.table(paste(tissues[i],"_net_sc_product_KL_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
go_deg<-read.table(paste(tissues[i],"_net_sc_DEG_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
#go_product<-go_product[go_product$FDR<0.05,]
#go_deg<-go_deg[go_deg$FDR<0.05,]
fdr_thresh<-0.05
diff_thresh<-2
interesting<-union(go_deg$Term[1:50],go_product$Term[1:50])
p3<-plot_GO_comparison_return_plot(go_deg,go_product,interesting,fdr_thresh,diff_thresh,paste(tissues[i],'_net_DEG_vs_KL_',nrow(tissue_deg_pairs),'_pairs.pdf',sep=""))
pdf(paste(tissues[i],"_pairs_KL_pseudo_count.pdf",sep=""))
print(p3)
dev.off()
}
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
go_product<-read.table(paste(tissues[i],"_net_sc_product_KL_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
go_deg<-read.table(paste(tissues[i],"_net_sc_DEG_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
#go_product<-go_product[go_product$FDR<0.05,]
#go_deg<-go_deg[go_deg$FDR<0.05,]
fdr_thresh<-0.05
diff_thresh<-2
interesting<-union(go_deg$Term[1:50],go_product$Term[1:50])
p3<-plot_GO_comparison_return_plot(go_deg,go_product,interesting,fdr_thresh,diff_thresh,paste(tissues[i],'_net_DEG_vs_KL_',nrow(tissue_deg_pairs),'_pairs.pdf',sep=""))
pdf(paste(tissues[i],"_pairs_KL_pseudo_count.pdf",sep=""))
print(p3)
dev.off()
}
source("~/bin/R_scripts/plot_GO_comparison_return_plot.R")
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
go_product<-read.table(paste(tissues[i],"_net_sc_product_KL_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
go_deg<-read.table(paste(tissues[i],"_net_sc_DEG_",nrow(tissue_deg_pairs),"_pairs_BP.txt",sep=""),header=T,sep="\t",stringsAsFactors = F)
#go_product<-go_product[go_product$FDR<0.05,]
#go_deg<-go_deg[go_deg$FDR<0.05,]
fdr_thresh<-0.05
diff_thresh<-2
interesting<-union(go_deg$Term[1:50],go_product$Term[1:50])
p3<-plot_GO_comparison_return_plot(go_deg,go_product,interesting,fdr_thresh,diff_thresh,paste(tissues[i],'_net_DEG_vs_KL_',nrow(tissue_deg_pairs),'_pairs.pdf',sep=""))
pdf(paste(tissues[i],"_pairs_KL_pseudo_count.pdf",sep=""))
print(p3)
dev.off()
}
source("~/bin/R_scripts/plot_lr_wiring.R")
n_cell<-4
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6.pdf")
plot_lr_wiring(as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_MI_CXCL16_CXCR6.pdf")
source("~/Dropbox/research_projects/ligand_receptor/perturblr/R/plot_lr_wiring.R")
n_cell<-4
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6.pdf")
n_cell<-4
pdf("CXCL16_CXCR6_healthy.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6.pdf")
dev.off()
pdf("CXCL16_CXCR6_MI.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_MI_CXCL16_CXCR6.pdf")
dev.off()
source("~/bin/R_scripts/plot_lr_wiring.R")
source("~/bin/R_scripts/plot_lr_wiring.R")
source("~/bin/R_scripts/plot_lr_wiring.R")
setwd("~/Dropbox/research_projects/ligand_receptor/")
#source("~/Dropbox/research_projects/ligand_receptor/perturblr/R/plot_lr_wiring.R")
n_cell<-4
#pdf("CXCL16_CXCR6_healthy.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6.pdf")
#dev.off()
#pdf("CXCL16_CXCR6_MI.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_MI_CXCL16_CXCR6.pdf")
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="THBS1_ITGA6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="THBS1_ITGA6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_THBS1_ITGA6.pdf")
setwd("~/Dropbox/research_projects/ligand_receptor/")
#source("~/Dropbox/research_projects/ligand_receptor/perturblr/R/plot_lr_wiring.R")
n_cell<-4
#pdf("CXCL16_CXCR6_healthy.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6.pdf")
#dev.off()
#pdf("CXCL16_CXCR6_MI.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_MI_CXCL16_CXCR6.pdf")
source("~/bin/R_scripts/plot_lr_wiring_no_edge_labels.R")
setwd("~/Dropbox/research_projects/ligand_receptor/")
#source("~/Dropbox/research_projects/ligand_receptor/perturblr/R/plot_lr_wiring.R")
n_cell<-4
source("~/bin/R_scripts/plot_lr_wiring_no_edge_labels.R")
setwd("~/Dropbox/research_projects/ligand_receptor/")
#source("~/Dropbox/research_projects/ligand_receptor/perturblr/R/plot_lr_wiring.R")
n_cell<-4
source("~/bin/R_scripts/plot_lr_wiring_no_edge_labels.R")
source("~/bin/R_scripts/plot_lr_wiring_no_edge_labels.R")
setwd("~/Dropbox/research_projects/ligand_receptor/")
#pdf("CXCL16_CXCR6_healthy.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6_nolabels.pdf")
#dev.off()
#pdf("CXCL16_CXCR6_MI.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_MI_CXCL16_CXCR6_nolabels.pdf")
source("~/bin/R_scripts/plot_lr_wiring_no_edge_labels.R")
#pdf("CXCL16_CXCR6_healthy.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6_nolabels.pdf")
#dev.off()
#pdf("CXCL16_CXCR6_MI.pdf",width=3,height=3)
plot_lr_wiring(as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_MI_CXCL16_CXCR6_nolabels.pdf")
source("~/bin/R_scripts/plot_lr_wiring_no_edge_labels.R")
#pdf("CXCL16_CXCR6_healthy.pdf",width=3,height=3)
plot_lr_wiring_no_edge_labels(as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_healthy_CXCL16_CXCR6_nolabels.pdf")
#dev.off()
#pdf("CXCL16_CXCR6_MI.pdf",width=3,height=3)
plot_lr_wiring_no_edge_labels(as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",17:(17+n_cell-1)]),as.numeric(mi_net[mi_net$Pair.Name=="CXCL16_CXCR6",(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),"heart_MI_CXCL16_CXCR6_nolabels.pdf")
pair2plot<-'WNT11_FZD7'
plot_lr_wiring_no_edge_labels(as.numeric(p56_net[p56_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(p56_net[p56_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),paste("heart_P56_",pair2plot,"_nolabels.pdf",sep=""))
plot_lr_wiring_no_edge_labels(as.numeric(p1_net[p1_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(p1_net[p1_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),c("Fibro","Endo","CM","Leuko"),paste("heart_P1_",pair2plot,"_nolabels.pdf",sep=""))
pair2plot<-'CCL5_CCR1'
plot_lr_wiring_no_edge_labels(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,"_nolabels.pdf",sep=""))
plot_lr_wiring_no_edge_labels(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,"_nolabels.pdf",sep=""))
n_cell<-length(cell_types)
#cell_types<-c("OPC","OLG","mNEUR","MG","EC","ASC","PC")
#cell_types<-c("OLG","mNEUR","MG","EC","ASC")
#cell_types<-c("OLG","mNEUR","MG","ASC")
#cell_types<-c("mNEUR","MG","ASC")
cell_types<-c("OLG","mNEUR","MG","EC","ASC","PC")
n_cell<-length(cell_types)
plot_lr_wiring_no_edge_labels(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,"_nolabels.pdf",sep=""))
plot_lr_wiring_no_edge_labels(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,"_nolabels.pdf",sep=""))
####One condition, at baseline
####Glomerulus######
load("FACS_bulk_RNAseq.RData")
load("~/Dropbox/research_projects/Kelly_Stevens/receptor_ligand_database_PMID26198319.RData")
load("~/Dropbox/research_projects/ensg2symbol2entrez_mouse.RData")
condition1<-tpm_mat[,sample_info$Genotype=="CD2(+/+) Fyn(+/+) MAFB(+)"]
condition2<-tpm_mat[,sample_info$Genotype=="CD2(+/+) Fyn(+/-) Meis(+)"]
condition3<-tpm_mat[,sample_info$Genotype=="CD2(+/+) Fyn(+/-) Tie2(+)"]
ind<-match(rownames(condition1),ensg2symbol$ensembl_gene_id)
all_genes<-ensg2symbol$mgi_symbol[ind]
good<- !is.na(all_genes)
all_genes<-all_genes[good]
condition1<-condition1[good,]
condition2<-condition2[good,]
condition3<-condition3[good,]
expression_level_normal<-data.frame(genes=all_genes,podo=rowMeans(condition1),meso=rowMeans(condition2),endo=rowMeans(condition3))
expression_level_normal$genes<-toupper(expression_level_normal$genes)
glom_net<-make_expressed_net(expression_level_normal,4,receptor_ligand,'product',1)
deg_pairs<-make_deg_net(expression_level_normal,glom_net,3,1)
n_cell<-3
l_mat<-uniq_deg[,17:(17+n_cell-1)]
r_mat<-uniq_deg[,(17+n_cell):(17+n_cell+n_cell-1)]
temp<-glom_net[1:204,]
uniq_kl<-temp[!(temp$Pair.Name %in% deg_pairs$Pair.Name),]
uniq_deg<-deg_pairs[!(deg_pairs$Pair.Name %in% temp$Pair.Name),]
n_cell<-3
l_mat<-uniq_deg[,17:(17+n_cell-1)]
r_mat<-uniq_deg[,(17+n_cell):(17+n_cell+n_cell-1)]
fc_l_max_deg<-log2((apply(l_mat,1,max)+1)/(apply(l_mat,1,min)+1))
fc_r_max_deg<-log2((apply(r_mat,1,max)+1)/(apply(r_mat,1,min)+1))
l_mat<-uniq_kl[,17:(17+n_cell-1)]
r_mat<-uniq_kl[,(17+n_cell):(17+n_cell+n_cell-1)]
fc_l_max_kl<-log2((apply(l_mat,1,max)+1)/(apply(l_mat,1,min)+1))
fc_r_max_kl<-log2((apply(r_mat,1,max)+1)/(apply(r_mat,1,min)+1))
df<-data.frame(LR=rep(c("Ligands","Receptors"),each=nrow(l_mat)*2),
Method=c(rep("DEG",times=nrow(l_mat)),rep("talklr",times=nrow(l_mat)),rep("DEG",times=nrow(l_mat)),rep("perturb\nComm",times=nrow(l_mat))),
Max.Log2.Fold.Change=c(fc_l_max_deg,fc_l_max_kl,fc_r_max_deg,fc_r_max_kl))
pdf("max_log2_FC_kidney_glom_v2.pdf",width=6,height=4)
#ggplot(df,aes(x=Method,y=Max.Log2.Fold.Change))+geom_violin() + geom_jitter() + facet_grid(~LR) + theme(axis.text = element_text(size=15),axis.title = element_text(size=16))
ggplot(df,aes(x=Method,y=Max.Log2.Fold.Change))+
#geom_violin(aes(fill=Method)) +
geom_violin(aes(fill=Method,color=Method)) +
#scale_fill_manual(values=c("mistyrose1","lightskyblue1")) +
scale_fill_manual(values=c("darkorange","darkolivegreen3")) +
geom_dotplot(binaxis='y', stackdir='center', dotsize=0.7,fill='grey50',color='grey50') +
facet_grid(~LR) +
theme(legend.position="none",axis.text = element_text(size=15),axis.title = element_text(size=16)) + theme_bw()
dev.off()
df<-data.frame(LR=rep(c("Ligands","Receptors"),each=nrow(l_mat)*2),
Method=c(rep("DEG",times=nrow(l_mat)),rep("talklr",times=nrow(l_mat)),rep("DEG",times=nrow(l_mat)),rep("talklr",times=nrow(l_mat))),
Max.Log2.Fold.Change=c(fc_l_max_deg,fc_l_max_kl,fc_r_max_deg,fc_r_max_kl))
pdf("max_log2_FC_kidney_glom_v2.pdf",width=6,height=4)
#ggplot(df,aes(x=Method,y=Max.Log2.Fold.Change))+geom_violin() + geom_jitter() + facet_grid(~LR) + theme(axis.text = element_text(size=15),axis.title = element_text(size=16))
ggplot(df,aes(x=Method,y=Max.Log2.Fold.Change))+
#geom_violin(aes(fill=Method)) +
geom_violin(aes(fill=Method,color=Method)) +
#scale_fill_manual(values=c("mistyrose1","lightskyblue1")) +
scale_fill_manual(values=c("darkorange","darkolivegreen3")) +
geom_dotplot(binaxis='y', stackdir='center', dotsize=0.7,fill='grey50',color='grey50') +
facet_grid(~LR) +
theme(legend.position="none",axis.text = element_text(size=15),axis.title = element_text(size=16)) + theme_bw()
dev.off()
#########################
#Heart, single cell#
load("~/Dropbox/research_projects/single cell metabolic network/Tabula_Muris_Smartseq2/heart.RData")
heart_genes<-heart$X
heart<-heart[,-1]
rownames(heart)<-heart_genes
sample_info<-read.csv("~/Dropbox/research_projects/single cell metabolic network/Tabula_Muris_Smartseq2/annotations_FACS.csv")
sample_info<-sample_info[sample_info$tissue=="Heart",]
sample_info$cell_ontology_class<-as.character(sample_info$cell_ontology_class)
ind<-match(sample_info$cell,colnames(heart))
heart<-heart[,ind]
total<-colSums(heart)/1e6
total<-total/median(total)
heart<-heart/matrix(rep(total,nrow(heart)),nrow=nrow(heart),ncol=ncol(heart),byrow = T)
expression_level_normal<-data.frame(genes=heart_genes,cm=rowMeans(heart[,sample_info$cell_ontology_class=="cardiac muscle cell"]),
endocardial=rowMeans(heart[,sample_info$cell_ontology_class=="endocardial cell"]),
endothelial=rowMeans(heart[,sample_info$cell_ontology_class=="endothelial cell"]),
fibroblast=rowMeans(heart[,sample_info$cell_ontology_class=="fibroblast"]),
smc=rowMeans(heart[,sample_info$cell_ontology_class=="smooth muscle cell"]))
heart_net<-make_expressed_net(expression_level_normal,5,receptor_ligand,'product',1)
deg_pairs<-make_deg_net(expression_level_normal,heart_net,3,1)
temp<-heart_net[1:98,]
uniq_kl<-temp[!(temp$Pair.Name %in% deg_pairs$Pair.Name),]
uniq_deg<-deg_pairs[!(deg_pairs$Pair.Name %in% temp$Pair.Name),]
n_cell<-5
l_mat<-uniq_deg[,17:(17+n_cell-1)]
r_mat<-uniq_deg[,(17+n_cell):(17+n_cell+n_cell-1)]
fc_l_max_deg<-log2((apply(l_mat,1,max)+1)/(apply(l_mat,1,min)+1))
fc_r_max_deg<-log2((apply(r_mat,1,max)+1)/(apply(r_mat,1,min)+1))
l_mat<-uniq_kl[,17:(17+n_cell-1)]
r_mat<-uniq_kl[,(17+n_cell):(17+n_cell+n_cell-1)]
fc_l_max_kl<-log2((apply(l_mat,1,max)+1)/(apply(l_mat,1,min)+1))
fc_r_max_kl<-log2((apply(r_mat,1,max)+1)/(apply(r_mat,1,min)+1))
df<-data.frame(LR=rep(c("Ligands","Receptors"),each=nrow(l_mat)*2),
Method=c(rep("DEG",times=nrow(l_mat)),rep("talklr",times=nrow(l_mat)),rep("DEG",times=nrow(l_mat)),rep("talklr",times=nrow(l_mat))),
Max.Log2.Fold.Change=c(fc_l_max_deg,fc_l_max_kl,fc_r_max_deg,fc_r_max_kl))
#pdf("max_log2_FC_heart_sc.pdf",width=4,height=4)
pdf("max_log2_FC_heart_sc_v4.pdf",width=6,height=4)
ggplot(df,aes(x=Method,y=Max.Log2.Fold.Change))+
#geom_violin(aes(fill=Method)) +
geom_violin(aes(fill=Method,color=Method)) +
#scale_fill_manual(values=c("mistyrose1","lightskyblue1")) +
#scale_fill_manual(values=c("mediumorchid","royalblue3")) +
scale_fill_manual(values=c("darkorange","darkolivegreen3")) +
geom_dotplot(binaxis='y', stackdir='center', dotsize=0.7,fill='grey50',color='grey50') +
facet_grid(~LR) +
theme(legend.position="none",axis.text = element_text(size=15),axis.title = element_text(size=16)) + theme_bw()
dev.off()
###Brain##
brain_sample_info<-read.csv("GSE75431_sample_info.csv")
setwd("./GSE75431_RAW/")
first<-read.table("GSM1955011_sample1.tsv.gz",header = T,sep="\t",stringsAsFactors = F)
files<-list.files("./",".tsv.gz")
brain<-matrix(0,nrow=nrow(first),ncol=length(files))
for (i in seq_along(files)){
temp<-read.table(files[i],header = T,sep="\t",stringsAsFactors = F)
if(sum(temp$ID_REF==first$ID_REF)==nrow(first)){
brain[,i]<-temp$VALUE
}
}
rownames(brain)<-first$ID_REF
colnames(brain)<-sapply(strsplit(files,"_"),function(x) x[1])
setwd("~/Dropbox/research_projects/ligand_receptor/")
load("~/Dropbox/research_projects/ensg2symbol2entrez_mouse.RData")
ind<-match(rownames(brain),ensg2symbol$entrezgene)
genes<-ensg2symbol$mgi_symbol[ind]
good<- !(is.na(genes))
brain<-brain[good,]
genes<-genes[good]
expression_level_normal<-data.frame(genes=toupper(genes),astro=rowMeans(brain[,brain_sample_info$Age=="13 months" & brain_sample_info$Genotype=="non-Tg" & brain_sample_info$cell_type=="astrocyte"]),
neuro=rowMeans(brain[,brain_sample_info$Age=="13 months" & brain_sample_info$Genotype=="non-Tg" & brain_sample_info$cell_type=="neuron"]),
micro=rowMeans(brain[,brain_sample_info$Age=="13 months" & brain_sample_info$Genotype=="non-Tg" & brain_sample_info$cell_type=="microglia"]))
brain_net<-make_expressed_net(expression_level_normal,2,receptor_ligand,'product',1)
deg_pairs<-make_deg_net(expression_level_normal,brain_net,2,1)
temp<-brain_net[1:159,]
uniq_kl<-temp[!(temp$Pair.Name %in% deg_pairs$Pair.Name),]
uniq_deg<-deg_pairs[!(deg_pairs$Pair.Name %in% temp$Pair.Name),]
n_cell<-3
l_mat<-uniq_deg[,17:(17+n_cell-1)]
r_mat<-uniq_deg[,(17+n_cell):(17+n_cell+n_cell-1)]
fc_l_max_deg<-log2((apply(l_mat,1,max)+1)/(apply(l_mat,1,min)+1))
fc_r_max_deg<-log2((apply(r_mat,1,max)+1)/(apply(r_mat,1,min)+1))
l_mat<-uniq_kl[,17:(17+n_cell-1)]
r_mat<-uniq_kl[,(17+n_cell):(17+n_cell+n_cell-1)]
fc_l_max_kl<-log2((apply(l_mat,1,max)+1)/(apply(l_mat,1,min)+1))
fc_r_max_kl<-log2((apply(r_mat,1,max)+1)/(apply(r_mat,1,min)+1))
df<-data.frame(LR=rep(c("Ligands","Receptors"),each=nrow(l_mat)*2),
Method=c(rep("DEG",times=nrow(l_mat)),rep("talklr",times=nrow(l_mat)),rep("DEG",times=nrow(l_mat)),rep("talklr",times=nrow(l_mat))),
Max.Log2.Fold.Change=c(fc_l_max_deg,fc_l_max_kl,fc_r_max_deg,fc_r_max_kl))
pdf("max_log2_FC_brain_3_celltypes_v3.pdf",width=6,height=4)
#ggplot(df,aes(x=Method,y=Max.Log2.Fold.Change))+geom_violin() + geom_jitter() + facet_grid(~LR) + theme(axis.text = element_text(size=15),axis.title = element_text(size=16))
ggplot(df,aes(x=Method,y=Max.Log2.Fold.Change))+
#geom_violin(aes(fill=Method)) +
geom_violin(aes(fill=Method,color=Method)) +
#scale_fill_manual(values=c("mistyrose1","lightskyblue1")) +
scale_fill_manual(values=c("darkorange","darkolivegreen3")) +
geom_dotplot(binaxis='y', stackdir='center', dotsize=0.7,fill='grey50',color='grey50') +
facet_grid(~LR) +
theme(legend.position="none",axis.text = element_text(size=15),axis.title = element_text(size=16)) + theme_bw()
dev.off()
View(aging_net)
pair2plot<-'SPP1_ITGAV'
n_cell<-length(cell_types)
n_cell
source("~/bin/R_scripts/plot_lr_wiring.R")
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
##Mouse brain aging##
setwd("~/Dropbox/research_projects/ligand_receptor/")
aging_mat<-read.xlsx("./aging_mouse_brain_scRNA/41593_2019_491_MOESM4_ESM.xlsx",sheet=2)
young<-aging_mat[,c(1,grep("Y_",colnames(aging_mat)))]
old<-aging_mat[,c(1,grep("O_",colnames(aging_mat)))]
young$Gene<-toupper(young$Gene)
old$Gene<-toupper(old$Gene)
colnames(young)[1]<-"genes"
colnames(old)[1]<-"genes"
colnames(young)<-gsub("Y_","",colnames(young))
colnames(old)<-gsub("O_","",colnames(old))
#cell_types<-c("OPC","OLG","mNEUR","MG","EC","ASC","PC")
#cell_types<-c("OLG","mNEUR","MG","EC","ASC")
#cell_types<-c("OLG","mNEUR","MG","ASC")
#cell_types<-c("mNEUR","MG","ASC")
cell_types<-c("OLG","mNEUR","MG","EC","ASC","PC")
young<-young[,c(1,which(colnames(young) %in% cell_types))]
old<-old[,c(1,which(colnames(old) %in% cell_types))]
expressed_genes<- intersect(young$genes[rowSums(young[,-1]>4)>=1],old$genes[rowSums(old[,-1]>4)>=1])
young_net<-make_expressed_net_specify_expressed_genes(young,expressed_genes,receptor_ligand[-grep("EXCLUDED",receptor_ligand$Pair.Evidence),],'product')
old_net<-make_expressed_net_specify_expressed_genes(old,expressed_genes,receptor_ligand[-grep("EXCLUDED",receptor_ligand$Pair.Evidence),],'product')
common<-intersect(young_net$Pair.Name,old_net$Pair.Name)
ind1<-match(common,young_net$Pair.Name)
ind2<-match(common,old_net$Pair.Name)
young_net<-young_net[ind1,]
old_net<-old_net[ind2,]
n_cell<-length(cell_types)
young_net$young_vs_old_KL<-disease_vs_normal_KL(old_net[,17:(17+n_cell-1)],old_net[,(17+n_cell):(17+2*n_cell-1)],young_net[,17:(17+n_cell-1)],young_net[,(17+n_cell):(17+2*n_cell-1)],method='product')
aging_net<-arrange(young_net,desc(young_vs_old_KL))
degs<- rowSums(abs(log2((old[,-1]+1)/(young[,-1]+1)))>log2(1.5))>=1
degs<-young$genes[degs]
deg_pairs<-young_net[young_net$Ligand.ApprovedSymbol %in% degs & young_net$Receptor.ApprovedSymbol %in% degs,]
deg_pairs[deg_pairs$Pair.Name=="CCL5_CCR1",]
temp<-aging_net[1:nrow(deg_pairs),]
uniq_kl<-temp[!(temp$Pair.Name %in% deg_pairs$Pair.Name),]
uniq_deg<-deg_pairs[!(deg_pairs$Pair.Name %in% temp$Pair.Name),]
View(uniq_kl)
pair2plot<-'IGF1_IGF1R'
source("~/bin/R_scripts/plot_lr_wiring.R")
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
pair2plot<-'ANGPT2_TEK'
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
pair2plot<-'LPL_LRP1'
n_cell<-length(cell_types)
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
pair2plot<-'SPP1_ITGAV'
plot_lr_wiring(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,".pdf",sep=""))
plot_lr_wiring_no_edge_labels(as.numeric(young_net[young_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(young_net[young_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Young_net_",pair2plot,"_nolabels.pdf",sep=""))
plot_lr_wiring_no_edge_labels(as.numeric(old_net[old_net$Pair.Name==pair2plot,17:(17+n_cell-1)]),as.numeric(old_net[old_net$Pair.Name==pair2plot,(17+n_cell):(17+2*n_cell-1)]),cell_types,paste("Old_net_",pair2plot,"_nolabels.pdf",sep=""))
young_net[young_net$Pair.Name=="SPP1_ITGAV",17:ncol(old_net)]
young_net[young_net$Pair.Name=="SPP1_ITGAV",17:ncol(old_net)]
old_net[old_net$Pair.Name=="SPP1_ITGAV",17:ncol(old_net)]
runApp('perturb_Comm')
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
write.xlsx(tissue_net,file=paste("talklr_results_",tissues[i],".xlsx"))
}
#plot#
setwd("./Tabula_Muris_V2/")
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
write.xlsx(tissue_net,file=paste("talklr_results_",tissues[i],".xlsx"))
}
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
write.xlsx(tissue_net,file=paste("talklr_results_",tissues[i],".xlsx",sep=""))
}
tissues
sample_info<-read.csv("~/Dropbox/research_projects/ligand_receptor/Tabula_Muris_V2/annotations_facs.csv")
tissues<-unique(sample_info$tissue)
for (i in seq_along(tissues)){
load(paste(tissues[i],"KL_deg_comparison.RData",sep=""))
write.xlsx(tissue_net,file=paste("talklr_results_",tissues[i],".xlsx",sep=""))
}
######What if we first log2 transform the expression data,will this reduce the influence of some highly expressed genes######
tissues<-unique(sample_info$tissue)
runApp('~/Dropbox/research_projects/ligand_receptor/perturb_Comm')
runApp('~/Dropbox/research_projects/ligand_receptor/talklr')
setwd("~/Dropbox/research_projects/ligand_receptor/talklr/")
devtools::document()
use_vignette("tallr_workflow")
library(devtools)
library(roxygen2)
use_vignette("tallr_workflow")
install.packages()
devtools::install()
